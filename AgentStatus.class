<!-- Gia Thanh Vuong - CPRG210 - Web Application Concepts - May 2016  -->
<!-- This class manages the authentication of the agent $isLoggedIn true if logged in-->

<?php
class AgentStatus {
  public $isLoggedIn = false;

  function __construct() {
    if (session_id() == "") {
      session_start();
    }
    if (isset($_SESSION['isLoggedIn']) &&  $_SESSION['isLoggedIn'] == true)  {
      $this->isLoggedIn = true;
    }
  }

public function authenticate($user, $pass) { // verify agent, and log him in if OK
  $fh = fopen("userinfo.txt", "r");
  while ($line = fgets($fh))
  {
   list($u, $p) = explode(",", $line);
   $users[$u] = chop($p);
  }
  fclose($fh);

  if (isset($users[$user]) && $users[$user] == md5($pass)) {
    $_SESSION['isLoggedIn'] = true;
    $this->isLoggedIn = true;
    return true;
  }
  return false;
}

function logout() { //log out agent
  $this->isLoggedIn = false;
  if (session_id() == "") {
    session_start();
  }
  $_SESSION['isLoggedIn'] = false;
  foreach ($_SESSION as $key => $value) {
    $_SESSION[$key] = "";
    unset($_SESSION[$key]);
  }
  $_SESSION = array();
  session_destroy();
}
}
 ?>
